{"version":3,"sources":["../../src/payu/index.js"],"names":["recurringPayments","require","tools","queries","tokenization","payments","PayU","prodAccountData","environment","payUUrlsMap","getPayUUrlsMapByEnvironment","accountData","getTestAccountData","validateConstructurParams","err","test","env","dev","prod","apiLogin","apiKey","merchantId","accountId","params","cb","validationResult","title","type","properties","required","errors","length","module","exports"],"mappings":";;;;AAAA;;;;AACA,IAAIA,oBAAoBC,QAAQ,qBAAR,CAAxB;AACA,IAAIC,QAAQD,QAAQ,SAAR,CAAZ;AACA,IAAIE,UAAUF,QAAQ,WAAR,CAAd;AACA,IAAIG,eAAeH,QAAQ,gBAAR,CAAnB;AACA,IAAII,WAAWJ,QAAQ,YAAR,CAAf;;IAEMK,I;AAEF,kBAAaC,eAAb,EAA8B;AAAA;;AAAA;;AAE1B;AACA,aAAKC,WAAL,GAAoB,CAAC,CAACD,eAAF,GAAoB,MAApB,GAA6B,KAAjD;AACA,aAAKE,WAAL,GAAmB,KAAKC,2BAAL,CAAiC,KAAKF,WAAtC,CAAnB;;AAEA;AACA,gBAAQ,KAAKA,WAAb;AACI,iBAAK,KAAL;AACI,qBAAKG,WAAL,GAAmB,KAAKC,kBAAL,EAAnB;AACJ;AACA,iBAAK,MAAL;AACI,qBAAKC,yBAAL,CAA+BN,eAA/B,EAAgD,UAACO,GAAD,EAAS;AACrD,wBAAIA,GAAJ,EAAS;AACL,8BAAMA,GAAN;AACA;AACH;AACD,0BAAKH,WAAL,GAAmBJ,eAAnB;AACH,iBAND;AAOJ;AAZJ;AAcA,aAAKI,WAAL,CAAiBI,IAAjB,GAAyB,KAAKP,WAAL,IAAoB,KAA7C;;AAEA;AACA,aAAKR,iBAAL,GAAyBA,kBAAkB,KAAKS,WAAvB,EAAoC,KAAKE,WAAzC,CAAzB;AACA,aAAKT,KAAL,GAAaA,MAAM,KAAKO,WAAX,EAAwB,KAAKE,WAA7B,CAAb;AACA,aAAKR,OAAL,GAAeA,QAAQ,KAAKM,WAAb,EAA0B,KAAKE,WAA/B,CAAf;AACA,aAAKP,YAAL,GAAoBA,aAAa,KAAKK,WAAlB,EAA+B,KAAKE,WAApC,CAApB;AACA,aAAKN,QAAL,GAAgBA,SAAS,KAAKI,WAAd,EAA2B,KAAKE,WAAhC,CAAhB;AACH;;;;oDAE4BK,G,EAAK;AAC9B,mBAAQ;AACJC,qBAAK;AACDd,6BAAS,+DADR;AAEDH,uCAAmB,gDAFlB;AAGDK,8BAAU;AAHT,iBADD;AAMJa,sBAAM;AACFf,6BAAS,uDADP;AAEFH,uCAAmB,wCAFjB;AAGFK,8BAAU;AAHR;AANF,aAAD,CAWJW,GAXI,CAAP;AAYH;;;6CAEqB;AAClB,mBAAO;AACHG,0BAAU,iBADP;AAEHC,wBAAQ,4BAFL;AAGHC,4BAAY,QAHT;AAIHC,2BAAW;AAJR,aAAP;AAMH;;;kDAE0BC,M,EAAQC,E,EAAI;AACnC,gBAAIC,mBAAmB,0BACnBF,MADmB,EACX;AACJG,uBAAO,yBADH;AAEJC,sBAAM,QAFF;AAGJC,4BAAY;AACRT,8BAAU,EAAEQ,MAAM,QAAR,EADF;AAERP,4BAAQ,EAAEO,MAAM,QAAR,EAFA;AAGRN,gCAAY,EAAEM,MAAM,QAAR,EAHJ;AAIRL,+BAAW,EAAEK,MAAM,QAAR;AAJH,iBAHR;AASJE,0BAAU,CAAC,UAAD,EAAa,QAAb,EAAuB,YAAvB,EAAqC,WAArC;AATN,aADW,CAAvB;AAaA,gBAAIJ,iBAAiBK,MAAjB,CAAwBC,MAA5B,EAAoC;AAChCP,mBAAGC,iBAAiBK,MAApB;AACA;AACH;AACDN;AACH;;;;;;AAILQ,OAAOC,OAAP,GAAiB3B,IAAjB","file":"index.js","sourcesContent":["import {validate as validateJSONSchema} from 'jsonschema';\nvar recurringPayments = require('./recurringPayments');\nvar tools = require('./tools');\nvar queries = require('./queries');\nvar tokenization = require('./tokenization');\nvar payments = require('./payments');\n\nclass PayU {\n\n    constructor (prodAccountData) {\n\n        // Initialize instance\n        this.environment = (!!prodAccountData ? 'prod' : 'dev');\n        this.payUUrlsMap = this.getPayUUrlsMapByEnvironment(this.environment);\n        \n        // Setup account data\n        switch (this.environment) {\n            case 'dev':\n                this.accountData = this.getTestAccountData();\n            break;\n            case 'prod':\n                this.validateConstructurParams(prodAccountData, (err) => {\n                    if (err) {\n                        throw err;\n                        return;\n                    }\n                    this.accountData = prodAccountData;\n                })\n            break;\n        }\n        this.accountData.test = (this.environment == 'dev');\n\n        // Setup transactions\n        this.recurringPayments = recurringPayments(this.payUUrlsMap, this.accountData);\n        this.tools = tools(this.payUUrlsMap, this.accountData);\n        this.queries = queries(this.payUUrlsMap, this.accountData);\n        this.tokenization = tokenization(this.payUUrlsMap, this.accountData);\n        this.payments = payments(this.payUUrlsMap, this.accountData);\n    }\n\n    getPayUUrlsMapByEnvironment (env) {\n        return ({\n            dev: {\n                queries: 'https://sandbox.api.payulatam.com/reports-api/4.0/service.cgi',\n                recurringPayments: 'https://sandbox.api.payulatam.com/payments-api',\n                payments: 'https://sandbox.api.payulatam.com/payments-api/4.0/service.cgi',\n            },\n            prod: {\n                queries: 'https://api.payulatam.com/reports-api/4.0/service.cgi',\n                recurringPayments: 'https://api.payulatam.com/payments-api',\n                payments: 'https://api.payulatam.com/payments-api/4.0/service.cgi',\n            },\n        })[env];\n    }\n\n    getTestAccountData () {\n        return {\n            apiLogin: 'pRRXKOl8ikMmt9u',\n            apiKey: '4Vj8eK4rloUd272L48hsrarnUA',\n            merchantId: '508029',\n            accountId: '512323',\n        }\n    }\n\n    validateConstructurParams (params, cb) {\n        var validationResult = validateJSONSchema(\n            params, {\n                title: 'PayU Constructor Schema',\n                type: 'object',\n                properties: {\n                    apiLogin: { type: 'string' },\n                    apiKey: { type: 'string' },\n                    merchantId: { type: 'string' },\n                    accountId: { type: 'string' },\n                },\n                required: ['apiLogin', 'apiKey', 'merchantId', 'accountId']\n            }\n        )\n        if (validationResult.errors.length) {\n            cb(validationResult.errors);\n            return;\n        }\n        cb();\n    }\n\n}\n\nmodule.exports = PayU;"]}